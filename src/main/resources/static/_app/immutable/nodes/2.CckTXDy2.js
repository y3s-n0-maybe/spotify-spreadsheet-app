import{f as D,a as O}from"../chunks/Asu1spAX.js";import{i as de}from"../chunks/Bu5nmECA.js";import{s as $,h as T,J as ue,I as _e,a as he,b as pe,w as c,a3 as se,r as ge,c as ye,d as Z,e as F,i as B,Z as me,f as le,g as ne,p as ke,a1 as oe,V as be,a4 as C,a5 as Q,a6 as J,L as W,a7 as xe,a8 as Te,a9 as Ee,a0 as we,aa as Ae,j as Se,ab as Re,ac as Ie,X as Le,ad as Me,ae as Ne,af as Ce,ag as He,o as Oe,ah as Be,A as De,ai as Ue,aj as Ge,G as I,k as Ve,C as qe,D as A,ak as L,F as E,al as Pe,B as ee}from"../chunks/BZ0CxAMn.js";import{a as Ye,l as $e,e as ae,s as V}from"../chunks/D8-ChdlA.js";import{i as X}from"../chunks/CCEvL4Ps.js";function Fe(e,a){return a}function Je(e,a,t,o){for(var s=[],l=a.length,v=0;v<l;v++)Ee(a[v].e,s,!0);var u=l>0&&s.length===0&&t!==null;if(u){var p=t.parentNode;we(p),p.append(t),o.clear(),M(e,a[0].prev,a[l-1].next)}Ae(s,()=>{for(var g=0;g<l;g++){var r=a[g];u||(o.delete(r.k),M(e,r.prev,r.next)),Se(r.e,!u)}})}function Xe(e,a,t,o,s,l=null){var v=e,u={flags:a,items:new Map,first:null};{var p=e;v=T?$(ue(p)):p.appendChild(_e())}T&&he();var g=null,r=!1,y=se(()=>{var n=t();return be(n)?n:n==null?[]:oe(n)});pe(()=>{var n=c(y),d=n.length;if(r&&d===0)return;r=d===0;let i=!1;if(T){var R=ge(v)===ye;R!==(d===0)&&(v=Z(),$(v),F(!1),i=!0)}if(T){for(var x=null,f,m=0;m<d;m++){if(B.nodeType===8&&B.data===me){v=B,i=!0,F(!1);break}var N=n[m],S=o(N,m);f=ie(B,u,x,null,N,S,m,s,a,t),u.items.set(S,f),x=f}d>0&&$(Z())}T||je(n,u,v,s,a,o,t),l!==null&&(d===0?g?le(g):g=ne(()=>l(v)):g!==null&&ke(g,()=>{g=null})),i&&F(!0),c(y)}),T&&(v=B)}function je(e,a,t,o,s,l,v){var u=e.length,p=a.items,g=a.first,r=g,y,n=null,d=[],i=[],R,x,f,m;for(m=0;m<u;m+=1){if(R=e[m],x=l(R,m),f=p.get(x),f===void 0){var N=r?r.e.nodes_start:t;n=ie(N,a,n,n===null?a.first:n.next,R,x,m,o,s,v),p.set(x,n),d=[],i=[],r=n.next;continue}if(ze(f,R,m),(f.e.f&J)!==0&&le(f.e),f!==r){if(y!==void 0&&y.has(f)){if(d.length<i.length){var S=i[0],w;n=S.prev;var U=d[0],_=d[d.length-1];for(w=0;w<d.length;w+=1)te(d[w],S,t);for(w=0;w<i.length;w+=1)y.delete(i[w]);M(a,U.prev,_.next),M(a,n,U),M(a,_,S),r=S,n=_,m-=1,d=[],i=[]}else y.delete(f),te(f,r,t),M(a,f.prev,f.next),M(a,f,n===null?a.first:n.next),M(a,n,f),n=f;continue}for(d=[],i=[];r!==null&&r.k!==x;)(r.e.f&J)===0&&(y??(y=new Set)).add(r),i.push(r),r=r.next;if(r===null)continue;f=r}d.push(f),n=f,r=f.next}if(r!==null||y!==void 0){for(var h=y===void 0?[]:oe(y);r!==null;)(r.e.f&J)===0&&h.push(r),r=r.next;var k=h.length;if(k>0){var b=u===0?t:null;Je(a,h,b,p)}}W.first=a.first&&a.first.e,W.last=n&&n.e}function ze(e,a,t,o){Te(e.v,a),e.i=t}function ie(e,a,t,o,s,l,v,u,p,g){var r=(p&Re)!==0,y=(p&Ie)===0,n=r?y?C(s):Q(s):s,d=(p&xe)===0?v:Q(v),i={i:d,v:n,k:l,a:null,e:null,prev:t,next:o};try{return i.e=ne(()=>u(e,n,d,g),T),i.e.prev=t&&t.e,i.e.next=o&&o.e,t===null?a.first=i:(t.next=i,t.e.next=i.e),o!==null&&(o.prev=i,o.e.prev=i.e),i}finally{}}function te(e,a,t){for(var o=e.next?e.next.e.nodes_start:t,s=a?a.e.nodes_start:t,l=e.e.nodes_start;l!==o;){var v=Le(l);s.before(l),l=v}}function M(e,a,t){a===null?e.first=t:(a.next=t,a.e.next=t&&t.e),t!==null&&(t.prev=a,t.e.prev=a&&a.e)}function Ke(e,a){return e==null?null:String(e)}function Ze(e,a,t,o){var s=e.__style;if(T||s!==a){var l=Ke(a);(!T||l!==e.getAttribute("style"))&&(l==null?e.removeAttribute("style"):e.style.cssText=l),e.__style=a}return o}const Qe=Symbol("is custom element"),We=Symbol("is html");function ea(e){if(T){var a=!1,t=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var o=e.value;re(e,"value",null),e.value=o}if(e.hasAttribute("checked")){var s=e.checked;re(e,"checked",null),e.checked=s}}};e.__on_r=t,Me(t),Ye()}}function re(e,a,t,o){var s=aa(e);T&&(s[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||s[a]!==(s[a]=t)&&(a==="loading"&&(e[Ne]=t),e.removeAttribute(a))}function aa(e){return e.__attributes??(e.__attributes={[Qe]:e.nodeName.includes("-"),[We]:e.namespaceURI===Ce})}function ta(e,a,t=a){var o=He();$e(e,"input",s=>{var l=s?e.defaultValue:e.value;if(l=j(e)?z(l):l,t(l),o&&l!==(l=a())){var v=e.selectionStart,u=e.selectionEnd;e.value=l??"",u!==null&&(e.selectionStart=v,e.selectionEnd=Math.min(u,e.value.length))}}),(T&&e.defaultValue!==e.value||Oe(a)==null&&e.value)&&t(j(e)?z(e.value):e.value),Be(()=>{var s=a();j(e)&&s===z(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function j(e){var a=e.type;return a==="number"||a==="range"}function z(e){return e===""?null:+e}var ra=D('<button class="svelte-1o4rg1p">Send to Backend</button>'),sa=D('<div class="progressBar svelte-1o4rg1p"><div class="progressBarFiller svelte-1o4rg1p"> </div></div>'),la=D('<tr><td class="svelte-1o4rg1p"> </td><td class="svelte-1o4rg1p"> </td><td class="svelte-1o4rg1p"> </td></tr>'),na=D('<table class="svelte-1o4rg1p"><thead><tr><th class="svelte-1o4rg1p">Track name</th><th class="svelte-1o4rg1p">Artist</th><th class="svelte-1o4rg1p">Album</th></tr></thead><tbody></tbody></table>'),oa=D('<head><title>Spotify Spreadsheet App</title></head> <h1 class="svelte-1o4rg1p">Spotify Spreadsheet Doohickey</h1> <h2 class="svelte-1o4rg1p">Please paste the link to your Spotify playlist here</h2> <div class="wrapper svelte-1o4rg1p"><input type="text" placeholder="https://open.spotify.com/playlist/xxxxxxxx" id="playlist-link" class="svelte-1o4rg1p"/></div> <div class="wrapper svelte-1o4rg1p"><button id="load-playlist" class="svelte-1o4rg1p">Go</button></div> <div class="wrapper svelte-1o4rg1p"><!></div> <!> <!>',1);function ua(e,a){De(a,!1);const t=C();let o="",s=C(""),l=C(),v=C(!0),u=C(),p=C();async function g(){L(t,[]),L(l,!0),console.log("fetching playlist..."),o=await(await fetch("/api/token")).text(),console.log("Token recieved:",o);const h=new Headers({Authorization:"Bearer "+o});let b=await(await fetch("https://api.spotify.com/v1/playlists/"+c(s).split("/").pop(),{headers:h,method:"GET"})).json();console.log(b),c(t).push.apply(c(t),b.tracks.items);let H=b.tracks.total;for(L(p,Math.ceil(H/100-1)),L(u,0);c(u)<c(p);Pe(u))b=await(await fetch(c(u)===0?b.tracks.next:b.next,{headers:h,method:"GET"})).json(),console.log(b),c(t).push.apply(c(t),b.items);console.log(c(t)),L(v,!1),L(l,!1)}function r(){console.log("Sending data to backend..."),fetch("/api/playlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tracks:c(t)})}).then(_=>_.blob()).then(_=>{var h=window.URL.createObjectURL(_);const k=document.createElement("a");k.href=h,k.download="playlist.xlsx",document.body.appendChild(k),k.click(),k.remove(),window.URL.revokeObjectURL(h)})}Ue(()=>{},()=>{L(t,[])}),Ge(),de();var y=oa(),n=I(Ve(y),6),d=A(n);ea(d),E(n);var i=I(n,2),R=A(i);E(i);var x=I(i,2),f=A(x);{var m=_=>{var h=ra();ae("click",h,r),O(_,h)};X(f,_=>{c(v)||_(m)})}E(x);var N=I(x,2);{var S=_=>{var h=sa(),k=A(h),b=A(k);E(k),E(h),ee(()=>{Ze(k,`width: ${c(u)/c(p)*450}`),V(b,`${c(u)??""}/${c(p)??""}`)}),O(_,h)};X(N,_=>{c(l)&&_(S)})}var w=I(N,2);{var U=_=>{var h=na(),k=I(A(h));Xe(k,5,()=>c(t),Fe,(b,H)=>{var G=la(),q=A(G),ve=A(q,!0);E(q);var P=I(q),fe=A(P,!0);E(P);var K=I(P),ce=A(K,!0);E(K),E(G),ee(Y=>{V(ve,c(H).track.name),V(fe,Y),V(ce,c(H).track.album.name)},[()=>c(H).track.artists.map(Y=>Y.name).join(", ")],se),O(b,G)}),E(k),E(h),O(_,h)};X(w,_=>{c(v)||_(U)})}ta(d,()=>c(s),_=>L(s,_)),ae("click",R,g),O(e,y),qe()}export{ua as component};
