import{f as U,a as O}from"../chunks/Asu1spAX.js";import{i as de}from"../chunks/Bu5nmECA.js";import{s as $,h as T,J as ue,I as _e,a as he,b as pe,w as o,a3 as ne,r as ye,c as ge,d as W,e as z,i as V,Z as me,f as ie,g as oe,p as ke,a1 as ve,V as be,a4 as D,a5 as ee,a6 as K,L as ae,a7 as xe,a8 as Te,a9 as we,a0 as Ee,aa as Ae,j as Se,ab as je,ac as Re,X as Ie,ad as Le,ae as Me,af as Ne,ag as Ce,o as Be,ah as He,A as Oe,ai as De,aj as Ue,G as L,k as Ge,C as Ve,D as S,ak as R,F as E,al as Pe,B as te}from"../chunks/BZ0CxAMn.js";import{a as qe,l as Fe,e as re,s as Y}from"../chunks/D8-ChdlA.js";import{i as P}from"../chunks/CCEvL4Ps.js";function Ye(e,a){return a}function Je(e,a,t,i){for(var s=[],l=a.length,c=0;c<l;c++)we(a[c].e,s,!0);var d=l>0&&s.length===0&&t!==null;if(d){var h=t.parentNode;Ee(h),h.append(t),i.clear(),M(e,a[0].prev,a[l-1].next)}Ae(s,()=>{for(var y=0;y<l;y++){var r=a[y];d||(i.delete(r.k),M(e,r.prev,r.next)),Se(r.e,!d)}})}function Xe(e,a,t,i,s,l=null){var c=e,d={flags:a,items:new Map,first:null};{var h=e;c=T?$(ue(h)):h.appendChild(_e())}T&&he();var y=null,r=!1,g=ne(()=>{var n=t();return be(n)?n:n==null?[]:ve(n)});pe(()=>{var n=o(g),u=n.length;if(r&&u===0)return;r=u===0;let v=!1;if(T){var I=ye(c)===ge;I!==(u===0)&&(c=W(),$(c),z(!1),v=!0)}if(T){for(var x=null,f,m=0;m<u;m++){if(V.nodeType===8&&V.data===me){c=V,v=!0,z(!1);break}var N=n[m],j=i(N,m);f=ce(V,d,x,null,N,j,m,s,a,t),d.items.set(j,f),x=f}u>0&&$(W())}T||$e(n,d,c,s,a,i,t),l!==null&&(u===0?y?ie(y):y=oe(()=>l(c)):y!==null&&ke(y,()=>{y=null})),v&&z(!0),o(g)}),T&&(c=V)}function $e(e,a,t,i,s,l,c){var d=e.length,h=a.items,y=a.first,r=y,g,n=null,u=[],v=[],I,x,f,m;for(m=0;m<d;m+=1){if(I=e[m],x=l(I,m),f=h.get(x),f===void 0){var N=r?r.e.nodes_start:t;n=ce(N,a,n,n===null?a.first:n.next,I,x,m,i,s,c),h.set(x,n),u=[],v=[],r=n.next;continue}if(ze(f,I,m),(f.e.f&K)!==0&&ie(f.e),f!==r){if(g!==void 0&&g.has(f)){if(u.length<v.length){var j=v[0],A;n=j.prev;var q=u[0],_=u[u.length-1];for(A=0;A<u.length;A+=1)se(u[A],j,t);for(A=0;A<v.length;A+=1)g.delete(v[A]);M(a,q.prev,_.next),M(a,n,q),M(a,_,j),r=j,n=_,m-=1,u=[],v=[]}else g.delete(f),se(f,r,t),M(a,f.prev,f.next),M(a,f,n===null?a.first:n.next),M(a,n,f),n=f;continue}for(u=[],v=[];r!==null&&r.k!==x;)(r.e.f&K)===0&&(g??(g=new Set)).add(r),v.push(r),r=r.next;if(r===null)continue;f=r}u.push(f),n=f,r=f.next}if(r!==null||g!==void 0){for(var p=g===void 0?[]:ve(g);r!==null;)(r.e.f&K)===0&&p.push(r),r=r.next;var b=p.length;if(b>0){var k=d===0?t:null;Je(a,p,k,h)}}ae.first=a.first&&a.first.e,ae.last=n&&n.e}function ze(e,a,t,i){Te(e.v,a),e.i=t}function ce(e,a,t,i,s,l,c,d,h,y){var r=(h&je)!==0,g=(h&Re)===0,n=r?g?D(s):ee(s):s,u=(h&xe)===0?c:ee(c),v={i:u,v:n,k:l,a:null,e:null,prev:t,next:i};try{return v.e=oe(()=>d(e,n,u,y),T),v.e.prev=t&&t.e,v.e.next=i&&i.e,t===null?a.first=v:(t.next=v,t.e.next=v.e),i!==null&&(i.prev=v,i.e.prev=v.e),v}finally{}}function se(e,a,t){for(var i=e.next?e.next.e.nodes_start:t,s=a?a.e.nodes_start:t,l=e.e.nodes_start;l!==i;){var c=Ie(l);s.before(l),l=c}}function M(e,a,t){a===null?e.first=t:(a.next=t,a.e.next=t&&t.e),t!==null&&(t.prev=a,t.e.prev=a&&a.e)}function Ke(e,a){return e==null?null:String(e)}function Ze(e,a,t,i){var s=e.__style;if(T||s!==a){var l=Ke(a);(!T||l!==e.getAttribute("style"))&&(l==null?e.removeAttribute("style"):e.style.cssText=l),e.__style=a}return i}const Qe=Symbol("is custom element"),We=Symbol("is html");function ea(e){if(T){var a=!1,t=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var i=e.value;le(e,"value",null),e.value=i}if(e.hasAttribute("checked")){var s=e.checked;le(e,"checked",null),e.checked=s}}};e.__on_r=t,Le(t),qe()}}function le(e,a,t,i){var s=aa(e);T&&(s[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||s[a]!==(s[a]=t)&&(a==="loading"&&(e[Me]=t),e.removeAttribute(a))}function aa(e){return e.__attributes??(e.__attributes={[Qe]:e.nodeName.includes("-"),[We]:e.namespaceURI===Ne})}function ta(e,a,t=a){var i=Ce();Fe(e,"input",s=>{var l=s?e.defaultValue:e.value;if(l=Z(e)?Q(l):l,t(l),i&&l!==(l=a())){var c=e.selectionStart,d=e.selectionEnd;e.value=l??"",d!==null&&(e.selectionStart=c,e.selectionEnd=Math.min(d,e.value.length))}}),(T&&e.defaultValue!==e.value||Be(a)==null&&e.value)&&t(Z(e)?Q(e.value):e.value),He(()=>{var s=a();Z(e)&&s===Q(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function Z(e){var a=e.type;return a==="number"||a==="range"}function Q(e){return e===""?null:+e}var ra=U('<button class="svelte-c7j7e5">Send to Backend</button>'),sa=U('<div class="progressBarFiller svelte-c7j7e5" style="width: 450px; background-color: lightgrey">Processing...</div>'),la=U('<div class="progressBarFiller svelte-c7j7e5"> </div>'),na=U('<div class="progressBar svelte-c7j7e5"><!></div>'),ia=U('<tr><td class="svelte-c7j7e5"> </td><td class="svelte-c7j7e5"> </td><td class="svelte-c7j7e5"> </td></tr>'),oa=U('<table class="svelte-c7j7e5"><thead><tr><th class="svelte-c7j7e5">Track name</th><th class="svelte-c7j7e5">Artist</th><th class="svelte-c7j7e5">Album</th></tr></thead><tbody></tbody></table>'),va=U('<head><title>Spotify Spreadsheet App</title></head> <h1 class="svelte-c7j7e5">Spotify Spreadsheet Doohickey</h1> <h2 class="svelte-c7j7e5">Please paste the link to your Spotify playlist here</h2> <div class="wrapper svelte-c7j7e5"><input type="text" placeholder="https://open.spotify.com/playlist/xxxxxxxx" id="playlist-link" class="svelte-c7j7e5"/></div> <div class="wrapper svelte-c7j7e5"><button id="load-playlist" class="svelte-c7j7e5">Go</button></div> <div class="wrapper svelte-c7j7e5"><!></div> <!> <!>',1);function ha(e,a){Oe(a,!1);const t=D();let i="",s=D(""),l=D(),c=D(!0),d=D(0),h=D(0);async function y(){R(t,[]),R(l,!0),console.log("fetching playlist..."),i=await(await fetch("/api/token")).text(),console.log("Token recieved:",i);const p=new Headers({Authorization:"Bearer "+i});let k=await(await fetch("https://api.spotify.com/v1/playlists/"+o(s).split("/").pop(),{headers:p,method:"GET"})).json();console.log(k),o(t).push.apply(o(t),k.tracks.items);let C=k.tracks.total;for(R(h,Math.ceil(C/100-1)),R(d,0);o(d)<o(h);Pe(d))k=await(await fetch(o(d)===0?k.tracks.next:k.next,{headers:p,method:"GET"})).json(),console.log(k),o(t).push.apply(o(t),k.items);console.log(o(t)),R(c,!1),R(l,!1)}function r(){console.log("Sending data to backend..."),fetch("/api/playlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tracks:o(t)})}).then(_=>_.blob()).then(_=>{var p=window.URL.createObjectURL(_);const b=document.createElement("a");b.href=p,b.download="playlist.xlsx",document.body.appendChild(b),b.click(),b.remove(),window.URL.revokeObjectURL(p)})}De(()=>{},()=>{R(t,[])}),Ue(),de();var g=va(),n=L(Ge(g),6),u=S(n);ea(u),E(n);var v=L(n,2),I=S(v);E(v);var x=L(v,2),f=S(x);{var m=_=>{var p=ra();re("click",p,r),O(_,p)};P(f,_=>{o(c)||_(m)})}E(x);var N=L(x,2);{var j=_=>{var p=na(),b=S(p);{var k=w=>{var B=sa();O(w,B)},C=(w,B)=>{{var J=H=>{var G=la(),F=S(G);E(G),te(()=>{Ze(G,`width: ${o(d)/o(h)*450}px; left:${-225+o(d)/o(h)*450/2}px`),Y(F,`${o(d)??""}/${o(h)??""}`)}),O(H,G)};P(w,H=>{o(h)!=0&&H(J)},B)}};P(b,w=>{R(h,0)?w(k):w(C,!1)})}E(p),O(_,p)};P(N,_=>{o(l)&&_(j)})}var A=L(N,2);{var q=_=>{var p=oa(),b=L(S(p));Xe(b,5,()=>o(t),Ye,(k,C)=>{var w=ia(),B=S(w),J=S(B,!0);E(B);var H=L(B),G=S(H,!0);E(H);var F=L(H),fe=S(F,!0);E(F),E(w),te(X=>{Y(J,o(C).track.name),Y(G,X),Y(fe,o(C).track.album.name)},[()=>o(C).track.artists.map(X=>X.name).join(", ")],ne),O(k,w)}),E(b),E(p),O(_,p)};P(A,_=>{o(c)||_(q)})}ta(u,()=>o(s),_=>R(s,_)),re("click",I,y),O(e,g),Ve()}export{ha as component};
