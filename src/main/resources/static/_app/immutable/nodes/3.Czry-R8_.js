import{f as q,a as N}from"../chunks/dCp5yQE-.js";import{i as me}from"../chunks/BM8G_BU0.js";import{o as ye}from"../chunks/DbxLcy9u.js";import{s as W,h as L,v as be,F as ke,a as Te,b as xe,k as n,ab as ie,r as we,c as Ee,d as ee,e as j,i as P,y as Se,f as le,g as de,p as Ae,C as fe,a0 as Re,m as U,ac as te,ad as Q,J as ae,ae as $e,af as Ie,ag as Ce,B as Le,ah as Me,o as Be,ai as De,aj as He,w as Ne,G as Oe,ak as re,al as Ue,X as I,q as qe,K as Fe,l as C,am as Ge,V as x,W as T,T as se}from"../chunks/HdAPPha1.js";import{s as O}from"../chunks/C7KxQh4V.js";import{i as V}from"../chunks/yZk2ktzU.js";import{e as Pe}from"../chunks/BCYTc9ki.js";import{s as Ve,b as ne}from"../chunks/Cwx8ikkR.js";import{t as Je}from"../chunks/DEoqk29U.js";import{s as Xe}from"../chunks/d65TZs8J.js";function Ye(a,e){return e}function ze(a,e,r,h){for(var g=[],f=e.length,u=0;u<f;u++)Ce(e[u].e,g,!0);var v=f>0&&g.length===0&&r!==null;if(v){var y=r.parentNode;Le(y),y.append(r),h.clear(),M(a,e[0].prev,e[f-1].next)}Me(g,()=>{for(var m=0;m<f;m++){var t=e[m];v||(h.delete(t.k),M(a,t.prev,t.next)),Be(t.e,!v)}})}function Ke(a,e,r,h,g,f=null){var u=a,v={flags:e,items:new Map,first:null};{var y=a;u=L?W(be(y)):y.appendChild(ke())}L&&Te();var m=null,t=!1,_=ie(()=>{var s=r();return Re(s)?s:s==null?[]:fe(s)});xe(()=>{var s=n(_),p=s.length;if(t&&p===0)return;t=p===0;let l=!1;if(L){var S=we(u)===Ee;S!==(p===0)&&(u=ee(),W(u),j(!1),l=!0)}if(L){for(var k=null,d,b=0;b<p;b++){if(P.nodeType===8&&P.data===Se){u=P,l=!0,j(!1);break}var B=s[b],A=h(B,b);d=ce(P,v,k,null,B,A,b,g,e,r),v.items.set(A,d),k=d}p>0&&W(ee())}L||We(s,v,u,g,e,h,r),f!==null&&(p===0?m?le(m):m=de(()=>f(u)):m!==null&&Ae(m,()=>{m=null})),l&&j(!0),n(_)}),L&&(u=P)}function We(a,e,r,h,g,f,u){var v=a.length,y=e.items,m=e.first,t=m,_,s=null,p=[],l=[],S,k,d,b;for(b=0;b<v;b+=1){if(S=a[b],k=f(S,b),d=y.get(k),d===void 0){var B=t?t.e.nodes_start:r;s=ce(B,e,s,s===null?e.first:s.next,S,k,b,h,g,u),y.set(k,s),p=[],l=[],t=s.next;continue}if(je(d,S,b),(d.e.f&Q)!==0&&le(d.e),d!==t){if(_!==void 0&&_.has(d)){if(p.length<l.length){var A=l[0],w;s=A.prev;var J=p[0],i=p[p.length-1];for(w=0;w<p.length;w+=1)oe(p[w],A,r);for(w=0;w<l.length;w+=1)_.delete(l[w]);M(e,J.prev,i.next),M(e,s,J),M(e,i,A),t=A,s=i,b-=1,p=[],l=[]}else _.delete(d),oe(d,t,r),M(e,d.prev,d.next),M(e,d,s===null?e.first:s.next),M(e,s,d),s=d;continue}for(p=[],l=[];t!==null&&t.k!==k;)(t.e.f&Q)===0&&(_??(_=new Set)).add(t),l.push(t),t=t.next;if(t===null)continue;d=t}p.push(d),s=d,t=d.next}if(t!==null||_!==void 0){for(var o=_===void 0?[]:fe(_);t!==null;)(t.e.f&Q)===0&&o.push(t),t=t.next;var c=o.length;if(c>0){var R=v===0?r:null;ze(e,o,R,y)}}ae.first=e.first&&e.first.e,ae.last=s&&s.e}function je(a,e,r,h){Ie(a.v,e),a.i=r}function ce(a,e,r,h,g,f,u,v,y,m){var t=(y&De)!==0,_=(y&He)===0,s=t?_?U(g):te(g):g,p=(y&$e)===0?u:te(u),l={i:p,v:s,k:f,a:null,e:null,prev:r,next:h};try{return l.e=de(()=>v(a,s,p,m),L),l.e.prev=r&&r.e,l.e.next=h&&h.e,r===null?e.first=l:(r.next=l,r.e.next=l.e),h!==null&&(h.prev=l,h.e.prev=l.e),l}finally{}}function oe(a,e,r){for(var h=a.next?a.next.e.nodes_start:r,g=e?e.e.nodes_start:r,f=a.e.nodes_start;f!==h;){var u=Ne(f);g.before(f),f=u}}function M(a,e,r){e===null?a.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}function Qe(a,e){return a==null?null:String(a)}function Ze(a,e,r,h){var g=a.__style;if(L||g!==e){var f=Qe(e);(!L||f!==a.getAttribute("style"))&&(f==null?a.removeAttribute("style"):a.style.cssText=f),a.__style=e}return h}const et=()=>{const a=Xe;return{page:{subscribe:a.page.subscribe},navigating:{subscribe:a.navigating.subscribe},updated:a.updated}},tt={subscribe(a){return et().page.subscribe(a)}};var at=q("<button>Send to Backend</button>"),rt=q('<div class="progressBarFiller" style="width: 450px; background-color: lightgrey">Processing...</div>'),st=q('<div class="progressBarFiller"> </div>'),nt=q('<div class="progressBar"><!></div>'),ot=q("<tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>"),it=q("<table><thead><tr><th>Track</th><th>Artist</th><th>Album</th><th>Popularity</th><th>Added at</th><th>Duration</th></tr></thead><tbody></tbody></table>"),lt=q('<head><title>Spotify Spreadsheet App: Table</title></head> <h1>Spotify Spreadsheet Doohickey: Table</h1> <div class="wrapper"><!></div> <!> <!>',1);function yt(a,e){Oe(e,!1);const[r,h]=Ve(),g=()=>ne(tt,"$page",r),f=()=>ne(Je,"$token",r),u=U(),v=U();let y=U(),m=U(!1),t=U(0),_=U(0);function s(){console.log("Sending data to backend..."),fetch("/api/playlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tracks:n(v)})}).then(i=>i.blob()).then(i=>{var o=window.URL.createObjectURL(i);const c=document.createElement("a");c.href=o,c.download="playlist.xlsx",document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(o)})}ye(async()=>{C(v,[]),C(y,!0),console.log("fetching playlist..."),console.log("Token: ",f());const i=new Headers({Authorization:"Bearer "+f()});console.log("Headers constructed.");let c=await(await fetch("https://api.spotify.com/v1/playlists/"+n(u),{headers:i,method:"GET"})).json();console.log(c),n(v).push.apply(n(v),c.tracks.items);let R=c.tracks.total;for(C(_,Math.ceil(R/100-1)),C(t,0);n(t)<n(_);Ge(t))c=await(await fetch(n(t)===0?c.tracks.next:c.next,{headers:i,method:"GET"})).json(),console.log(c),n(v).push.apply(n(v),c.items);console.log(n(v)),C(m,!0),C(y,!1)});function p(i){const o=new Date(i);return o.toLocaleDateString()+" "+o.toLocaleTimeString()}function l(i){let o=Math.round(i/1e3),c=Math.floor(o/60);o%=60;let R=o<10?"0"+o:o;return`${c}:${R}`}re(()=>g(),()=>{C(u,g().params.playlistId)}),re(()=>{},()=>{C(v,[])}),Ue(),me();var S=lt(),k=I(qe(S),4),d=x(k);{var b=i=>{var o=at();Pe("click",o,s),N(i,o)};V(d,i=>{n(m)&&i(b)})}T(k);var B=I(k,2);{var A=i=>{var o=nt(),c=x(o);{var R=E=>{var D=rt();N(E,D)},$=(E,D)=>{{var X=H=>{var F=st(),G=x(F);T(F),se(()=>{Ze(F,`width: ${n(t)/n(_)*450}px; left:${-225+n(t)/n(_)*450/2}px`),O(G,`${n(t)??""}/${n(_)??""}`)}),N(H,F)};V(E,H=>{n(_)!=0&&H(X)},D)}};V(c,E=>{C(_,0)?E(R):E($,!1)})}T(o),N(i,o)};V(B,i=>{n(y)&&i(A)})}var w=I(B,2);{var J=i=>{var o=it(),c=I(x(o));Ke(c,5,()=>n(v),Ye,(R,$)=>{var E=ot(),D=x(E),X=x(D,!0);T(D);var H=I(D),F=x(H,!0);T(H);var G=I(H),ue=x(G,!0);T(G);var Y=I(G),ve=x(Y,!0);T(Y);var z=I(Y),pe=x(z,!0);T(z);var Z=I(z),he=x(Z,!0);T(Z),T(E),se((K,_e,ge)=>{O(X,n($).track.name),O(F,K),O(ue,n($).track.album.name),O(ve,n($).track.popularity),O(pe,_e),O(he,ge)},[()=>n($).track.artists.map(K=>K.name).join(", "),()=>p(n($).added_at),()=>l(n($).track.duration_ms)],ie),N(R,E)}),T(c),T(o),N(i,o)};V(w,i=>{n(m)&&i(J)})}N(a,S),Fe(),h()}export{yt as component};
