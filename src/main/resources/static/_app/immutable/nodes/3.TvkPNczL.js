import{f as q,a as N}from"../chunks/dCp5yQE-.js";import{i as me}from"../chunks/BM8G_BU0.js";import{o as ye}from"../chunks/DbxLcy9u.js";import{s as W,h as L,v as be,F as ke,a as Te,b as xe,k as n,ab as le,r as we,c as Ee,d as ee,e as j,i as P,y as Se,f as ie,g as de,p as Ae,C as fe,a0 as Re,m as U,ac as te,ad as Q,J as ae,ae as $e,af as Ie,ag as Ce,B as Le,ah as Me,o as Be,ai as He,aj as De,w as Ne,G as Oe,ak as re,al as Ue,X as I,q as qe,K as Fe,l as C,am as Ge,V as x,W as T,T as se}from"../chunks/HdAPPha1.js";import{s as O}from"../chunks/C7KxQh4V.js";import{i as V}from"../chunks/yZk2ktzU.js";import{e as Pe}from"../chunks/BCYTc9ki.js";import{s as Ve,b as ne}from"../chunks/Cwx8ikkR.js";import{t as Je}from"../chunks/DEoqk29U.js";import{s as Xe}from"../chunks/DH0nzZ-w.js";function Ye(a,e){return e}function ze(a,e,r,h){for(var g=[],f=e.length,v=0;v<f;v++)Ce(e[v].e,g,!0);var u=f>0&&g.length===0&&r!==null;if(u){var y=r.parentNode;Le(y),y.append(r),h.clear(),M(a,e[0].prev,e[f-1].next)}Me(g,()=>{for(var m=0;m<f;m++){var t=e[m];u||(h.delete(t.k),M(a,t.prev,t.next)),Be(t.e,!u)}})}function Ke(a,e,r,h,g,f=null){var v=a,u={flags:e,items:new Map,first:null};{var y=a;v=L?W(be(y)):y.appendChild(ke())}L&&Te();var m=null,t=!1,_=le(()=>{var s=r();return Re(s)?s:s==null?[]:fe(s)});xe(()=>{var s=n(_),p=s.length;if(t&&p===0)return;t=p===0;let i=!1;if(L){var S=we(v)===Ee;S!==(p===0)&&(v=ee(),W(v),j(!1),i=!0)}if(L){for(var k=null,d,b=0;b<p;b++){if(P.nodeType===8&&P.data===Se){v=P,i=!0,j(!1);break}var B=s[b],A=h(B,b);d=ce(P,u,k,null,B,A,b,g,e,r),u.items.set(A,d),k=d}p>0&&W(ee())}L||We(s,u,v,g,e,h,r),f!==null&&(p===0?m?ie(m):m=de(()=>f(v)):m!==null&&Ae(m,()=>{m=null})),i&&j(!0),n(_)}),L&&(v=P)}function We(a,e,r,h,g,f,v){var u=a.length,y=e.items,m=e.first,t=m,_,s=null,p=[],i=[],S,k,d,b;for(b=0;b<u;b+=1){if(S=a[b],k=f(S,b),d=y.get(k),d===void 0){var B=t?t.e.nodes_start:r;s=ce(B,e,s,s===null?e.first:s.next,S,k,b,h,g,v),y.set(k,s),p=[],i=[],t=s.next;continue}if(je(d,S,b),(d.e.f&Q)!==0&&ie(d.e),d!==t){if(_!==void 0&&_.has(d)){if(p.length<i.length){var A=i[0],w;s=A.prev;var J=p[0],l=p[p.length-1];for(w=0;w<p.length;w+=1)oe(p[w],A,r);for(w=0;w<i.length;w+=1)_.delete(i[w]);M(e,J.prev,l.next),M(e,s,J),M(e,l,A),t=A,s=l,b-=1,p=[],i=[]}else _.delete(d),oe(d,t,r),M(e,d.prev,d.next),M(e,d,s===null?e.first:s.next),M(e,s,d),s=d;continue}for(p=[],i=[];t!==null&&t.k!==k;)(t.e.f&Q)===0&&(_??(_=new Set)).add(t),i.push(t),t=t.next;if(t===null)continue;d=t}p.push(d),s=d,t=d.next}if(t!==null||_!==void 0){for(var o=_===void 0?[]:fe(_);t!==null;)(t.e.f&Q)===0&&o.push(t),t=t.next;var c=o.length;if(c>0){var R=u===0?r:null;ze(e,o,R,y)}}ae.first=e.first&&e.first.e,ae.last=s&&s.e}function je(a,e,r,h){Ie(a.v,e),a.i=r}function ce(a,e,r,h,g,f,v,u,y,m){var t=(y&He)!==0,_=(y&De)===0,s=t?_?U(g):te(g):g,p=(y&$e)===0?v:te(v),i={i:p,v:s,k:f,a:null,e:null,prev:r,next:h};try{return i.e=de(()=>u(a,s,p,m),L),i.e.prev=r&&r.e,i.e.next=h&&h.e,r===null?e.first=i:(r.next=i,r.e.next=i.e),h!==null&&(h.prev=i,h.e.prev=i.e),i}finally{}}function oe(a,e,r){for(var h=a.next?a.next.e.nodes_start:r,g=e?e.e.nodes_start:r,f=a.e.nodes_start;f!==h;){var v=Ne(f);g.before(f),f=v}}function M(a,e,r){e===null?a.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}function Qe(a,e){return a==null?null:String(a)}function Ze(a,e,r,h){var g=a.__style;if(L||g!==e){var f=Qe(e);(!L||f!==a.getAttribute("style"))&&(f==null?a.removeAttribute("style"):a.style.cssText=f),a.__style=e}return h}const et=()=>{const a=Xe;return{page:{subscribe:a.page.subscribe},navigating:{subscribe:a.navigating.subscribe},updated:a.updated}},tt={subscribe(a){return et().page.subscribe(a)}};var at=q("<button>Send to Backend</button>"),rt=q('<div class="progressBarFiller" style="width: 450px; background-color: lightgrey">Processing...</div>'),st=q('<div class="progressBarFiller"> </div>'),nt=q('<div class="progressBar"><!></div>'),ot=q("<tr><td> </td><td> </td><td> </td><td> </td><td> </td><td> </td></tr>"),lt=q("<table><thead><tr><th>Track name</th><th>Artist</th><th>Album</th><th>Popularity</th><th>Added at</th></tr></thead><tbody></tbody></table>"),it=q('<head><title>Spotify Spreadsheet App: Table</title></head> <h1>Spotify Spreadsheet Doohickey: Table</h1> <div class="wrapper"><!></div> <!> <!>',1);function yt(a,e){Oe(e,!1);const[r,h]=Ve(),g=()=>ne(tt,"$page",r),f=()=>ne(Je,"$token",r),v=U(),u=U();let y=U(),m=U(!1),t=U(0),_=U(0);function s(){console.log("Sending data to backend..."),fetch("/api/playlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tracks:n(u)})}).then(l=>l.blob()).then(l=>{var o=window.URL.createObjectURL(l);const c=document.createElement("a");c.href=o,c.download="playlist.xlsx",document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(o)})}ye(async()=>{C(u,[]),C(y,!0),console.log("fetching playlist..."),console.log("Token: ",f());const l=new Headers({Authorization:"Bearer "+f()});console.log("Headers constructed.");let c=await(await fetch("https://api.spotify.com/v1/playlists/"+n(v),{headers:l,method:"GET"})).json();console.log(c),n(u).push.apply(n(u),c.tracks.items);let R=c.tracks.total;for(C(_,Math.ceil(R/100-1)),C(t,0);n(t)<n(_);Ge(t))c=await(await fetch(n(t)===0?c.tracks.next:c.next,{headers:l,method:"GET"})).json(),console.log(c),n(u).push.apply(n(u),c.items);console.log(n(u)),C(m,!0),C(y,!1)});function p(l){const o=new Date(l);return o.toLocaleDateString()+" "+o.toLocaleTimeString()}function i(l){let o=Math.round(l/1e3),c=Math.floor(o/60);o%=60;let R=o<10?"0"+o:o;return`${c}:${R}`}re(()=>g(),()=>{C(v,g().params.playlistId)}),re(()=>{},()=>{C(u,[])}),Ue(),me();var S=it(),k=I(qe(S),4),d=x(k);{var b=l=>{var o=at();Pe("click",o,s),N(l,o)};V(d,l=>{n(m)&&l(b)})}T(k);var B=I(k,2);{var A=l=>{var o=nt(),c=x(o);{var R=E=>{var H=rt();N(E,H)},$=(E,H)=>{{var X=D=>{var F=st(),G=x(F);T(F),se(()=>{Ze(F,`width: ${n(t)/n(_)*450}px; left:${-225+n(t)/n(_)*450/2}px`),O(G,`${n(t)??""}/${n(_)??""}`)}),N(D,F)};V(E,D=>{n(_)!=0&&D(X)},H)}};V(c,E=>{C(_,0)?E(R):E($,!1)})}T(o),N(l,o)};V(B,l=>{n(y)&&l(A)})}var w=I(B,2);{var J=l=>{var o=lt(),c=I(x(o));Ke(c,5,()=>n(u),Ye,(R,$)=>{var E=ot(),H=x(E),X=x(H,!0);T(H);var D=I(H),F=x(D,!0);T(D);var G=I(D),ve=x(G,!0);T(G);var Y=I(G),ue=x(Y,!0);T(Y);var z=I(Y),pe=x(z,!0);T(z);var Z=I(z),he=x(Z,!0);T(Z),T(E),se((K,_e,ge)=>{O(X,n($).track.name),O(F,K),O(ve,n($).track.album.name),O(ue,n($).track.popularity),O(pe,_e),O(he,ge)},[()=>n($).track.artists.map(K=>K.name).join(", "),()=>p(n($).added_at),()=>i(n($).track.duration_ms)],le),N(R,E)}),T(c),T(o),N(l,o)};V(w,l=>{n(m)&&l(J)})}N(a,S),Fe(),h()}export{yt as component};
